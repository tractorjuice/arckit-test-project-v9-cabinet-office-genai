# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

ArcKit is an **Enterprise Architecture Governance & Vendor Procurement Toolkit** - a Python CLI that provides 40 slash commands for AI coding assistants (Claude Code, Codex CLI, Gemini CLI) to generate architecture artifacts. It transforms architecture governance from scattered documents into a systematic, template-driven process.

## Build & Development Commands

```bash
# Install in development mode
pip install -e .
# Or using uv (recommended)
uv pip install -e .

# Test CLI
arckit --help
arckit check

# Test project initialization
arckit init test-project --ai claude --no-git
cd test-project && ls -la .claude/commands/

# Build distribution
python -m build

# Convert Claude commands to Gemini format
python scripts/converter.py

# Debug data path resolution
python -c "from arckit_cli import get_data_paths; print(get_data_paths())"
```

## Architecture

### Core Components

**CLI Entry Point** (`src/arckit_cli/__init__.py`):
- Single-file CLI using `typer` for command parsing
- `arckit init` creates project structure and copies templates/commands from package data
- `arckit check` validates tool installation
- `get_data_paths()` handles data resolution across install methods (uv tools, pip, source)

**Package Data** (distributed via `pyproject.toml` shared-data):
- `.claude/commands/arckit.*.md` - Slash commands (YAML frontmatter + prompt)
- `.gemini/commands/arckit/*.toml` - Gemini equivalents (generated by `scripts/converter.py`)
- `.codex/prompts/arckit/*.md` - Codex prompts (same as Claude)
- `.arckit/templates/*.md` - Document templates
- `scripts/bash/*.sh` - Helper scripts

**Data Path Resolution Order** (in `get_data_paths()`):
1. uv tool install: `~/.local/share/uv/tools/arckit-cli/share/arckit/`
2. pip install: `{site-packages}/share/arckit/`
3. platformdirs: `{user_data_dir}/arckit/`
4. Source/dev mode: `{repo_root}/`

### Slash Command System

Commands live in `.claude/commands/arckit.{name}.md` with this structure:

```yaml
---
description: Brief description (shown in /help)
---

## User Input
$ARGUMENTS

## Instructions
1. Check prerequisites (principles exist, etc.)
2. Create/find project via create-project.sh --name "X" --json
3. Read template from .arckit/templates/{type}-template.md
4. Generate artifact using template structure
5. **Use Write tool** to create file (critical - avoids 32K token limit)
6. Show summary only (not full document)
```

**Multi-AI Command Formats**:
| AI | Format | Location |
|----|--------|----------|
| Claude Code | `/arckit.requirements` | `.claude/commands/arckit.requirements.md` |
| Codex CLI | `/prompts:arckit.requirements` | `.codex/prompts/arckit/requirements.md` |
| Gemini CLI | `/arckit:requirements` | `.gemini/commands/arckit/requirements.toml` |

### Project Structure Created by `arckit init`

```
project/
├── .arckit/
│   ├── memory/           # Global principles (architecture-principles.md)
│   ├── templates/        # Document templates
│   └── scripts/bash/     # create-project.sh, generate-document-id.sh, etc.
├── .claude/commands/     # Slash commands (or .codex/ or .gemini/)
└── projects/
    └── 001-project-name/ # Numbered project directories
        ├── requirements.md
        ├── stakeholder-drivers.md
        ├── risk-register.md
        ├── sobc.md
        └── vendors/
```

### Helper Scripts

**`scripts/bash/create-project.sh`**: Creates numbered project directories (001-*, 002-*), returns JSON with path
**`scripts/bash/generate-document-id.sh`**: Generates doc IDs (e.g., ARC-001-REQ-v1.0)
**`scripts/converter.py`**: Converts Claude commands (.md) to Gemini format (.toml)

## Adding a New Slash Command

1. Create `.claude/commands/arckit.{name}.md` with YAML frontmatter
2. Create `.arckit/templates/{name}-template.md` with document control section
3. Run `python scripts/converter.py` to generate Gemini TOML
4. Test: `arckit init test --ai claude --no-git && cd test && claude`
5. Update README.md Available Commands table

**Command must**:
- Check prerequisites before generating
- Use `create-project.sh --json` to get/create project path
- Read the corresponding template file
- **Use Write tool** to save output (avoids token limit issues)
- Show only a summary to user

## Version Management

**Version defined in 2 places** (keep synchronized):
1. `VERSION` file (source of truth)
2. `pyproject.toml` `version` field

**Adding new package data files**: Update `pyproject.toml` `[tool.hatch.build.targets.wheel.shared-data]`

## Test Repositories

ArcKit maintains 15 test repos on GitHub (pattern: `arckit-test-project-v*`):

| Version | Name | Type | Description |
|---------|------|------|-------------|
| v0 | mod-chatbot | Private | MOD chatbot project |
| v1 | m365 | Public | Microsoft 365 migration |
| v2 | hmrc-chatbot | Public | HMRC chatbot |
| v3 | windows11 | Public | Windows 11 deployment |
| v4 | ipa | Private | Infrastructure Projects Authority |
| v5 | dstl | Private | Defence Science & Technology Lab |
| v6 | patent-system | Public | Patent system modernization |
| v7 | nhs-appointment | Public | NHS appointment booking |
| v8 | ons-data-platform | Public | ONS data platform |
| v9 | cabinet-office-genai | Public | Cabinet Office GenAI |
| v10 | training-marketplace | Public | UK Government Training Marketplace |
| v11 | national-highways-data | Public | National Highways data architecture |
| v12 | honky-tonks | Private | Restaurant data analytics |
| v13 | plymouth-research | Private | Plymouth restaurant web scraping |
| v14 | scottish-courts | Private | Scottish Courts and Tribunals Service GenAI strategy |

**Sync test repos after changes**:
```bash
# Clone and update all test repos
TOKEN="<github-token>"
for repo in v0-mod-chatbot v1-m365 v2-hmrc-chatbot v3-windows11 v4-ipa v5-dstl \
            v6-patent-system v7-nhs-appointment v8-ons-data-platform v9-cabinet-office-genai \
            v10-training-marketplace v11-national-highways-data v12-honky-tonks v13-plymouth-research \
            v14-scottish-courts; do
    git clone "https://x-access-token:${TOKEN}@github.com/tractorjuice/arckit-test-project-$repo.git" /tmp/$repo
    rsync -av --delete .claude/commands/ /tmp/$repo/.claude/commands/
    rsync -av --delete .codex/prompts/ /tmp/$repo/.codex/prompts/
    rsync -av --delete .gemini/commands/ /tmp/$repo/.gemini/commands/
    rsync -av --delete .arckit/templates/ /tmp/$repo/.arckit/templates/
    rsync -av scripts/bash/ /tmp/$repo/.arckit/scripts/bash/
    cd /tmp/$repo && git add -A && git commit -m "chore: sync with arc-kit" && git push && cd -
done
```

## Key Patterns

**Token Limit Handling**: Commands MUST use Write tool for large documents (requirements, SOBC, research) to avoid 32K output token limit.

**Template-Driven Generation**: Never generate freeform documents - always use templates from `.arckit/templates/`.

**Traceability Chain**: Stakeholders → Goals → Requirements (BR/FR/NFR/INT/DR) → Data Model → Components → User Stories

**Requirement ID Prefixes**:
- BR-xxx: Business Requirements
- FR-xxx: Functional Requirements
- NFR-xxx: Non-Functional (NFR-P-xxx Performance, NFR-SEC-xxx Security, etc.)
- INT-xxx: Integration Requirements
- DR-xxx: Data Requirements

**UK Government Context**: Many commands target UK public sector (GDS Service Standard, TCoP, NCSC CAF, Orange/Green Book, G-Cloud/DOS procurement). See README.md for full compliance coverage.

**Wardley Map Format**: OnlineWardleyMaps syntax for visualization at https://create.wardleymaps.ai
